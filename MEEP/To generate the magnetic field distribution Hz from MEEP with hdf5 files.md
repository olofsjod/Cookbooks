# To generate the magnetic field distribution Hz from MEEP
written by Olof Sj√∂din <olsj@kth.se> 2023-04-17.

The field data generated by MEEP are stored in HDF5 format. These fields are recorded in an specified interval in the time domain. With this data we can plot the field in a structure with respect to time. Here comes a description on how one can generate a Gif of the field distribution in the time domain.

In order to plot the field we can use the tools provided from the `h5utils`. To install `h5utils` on Ubuntu:
```
sudo apt install h5utils
```
This includes two utilities that we are going to use: `h5ls` and `h5topng`. The former gives the user the ability to inspect the data size such as the number of time sequences. An example given the data in this directory:
```
$ h5ls power_calc_inoue2020-Hz.h5 
hz                       Dataset {820, 820, 142, 70/Inf}
```
As we can see is that the magnetic field `hz` has a size of x=820, y=820, z=142 and t=70 time steps. 

In the latter case you are generating an image from a chosen 2D plane in the data set. The color represents the magnitude of the field and the scale is automatically adjusted such that the image generated all have the same scale. 

An example command using the previously mentioned data:
```
$ h5topng \
	-t 0:69 					# Time begins at 0 and 69 corresponds to the last time in the dataset \
	-0      					# Rescales x, y and z such that origo corresponds to the center of the data set \
	-y 0    					# Chooses the plane where y=0 \
	-R						# Rescales the colormap such that the scale is consistent with each other \
	-Zc dkbluered 					# Rescales the colorscale such that the center is zero AND choose the colormap dkbluered (see man h5topng) \
	-A power_calc_inoue2020-eps-000000.00.h5 	# The overlay data. We are overlaying the dielectric constant on top on the field data. \
	-a yarg 					# The colormap for the overlay. yarg means transperent black to opaque white \
	power_calc_inoue2020-Hz.h5			# The magnetic field data Hz.
```
Or more compactly:
```
$ h5topng -t 0:69 -0 -y 0 -R -Zc dkbluered -a yarg -A power_calc_inoue2020-eps-000000.00.h5 power_calc_inoue2020-Hz.h5
```

This will generate the data as image files (PNG format) in the same catalogue where the command was run in. To convert the series of image files into a Gif you can use the `imagemagick` tool `convert`:
```
convert power_calc_inoue2020-Hz.t*.png Hz-y0.gif
```
